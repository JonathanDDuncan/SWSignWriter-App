{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/Fernando Martinez/Documents/Programacion/SignWriter/Frontend JD/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { TranslateService } from '@ngx-translate/core';\nimport { HttpClient } from '@angular/common/http';\nimport { ChangeDetectorRef } from '@angular/core';\nimport { ModalController, ToastController } from '@ionic/angular';\nimport { DomSanitizer } from '@angular/platform-browser';\nimport { uuid } from 'uuidv4';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ionic/angular\";\nimport * as i2 from \"@angular/platform-browser\";\nimport * as i3 from \"@ngx-translate/core\";\nimport * as i4 from \"@angular/common/http\";\nexport class ShareDesktopPage {\n  constructor(modalController, toastController, sanitizer, translateService, ref, http) {\n    this.modalController = modalController;\n    this.toastController = toastController;\n    this.sanitizer = sanitizer;\n    this.translateService = translateService;\n    this.ref = ref;\n    this.http = http;\n    this.serverUrl = window.location && window.location.hostname && window.location.hostname.includes('localhost') ? 'https://localhost:44309/' : 'https://swsignwriterapi.azurewebsites.net/';\n  }\n\n  ngOnInit() {\n    this.swCanvas = this.canvas;\n    this.saveToRemote(this.imagebase64);\n  }\n\n  ngAfterContentChecked() {\n    this.ref.detectChanges();\n  }\n\n  saveToRemote(imagebase64) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      _this.imageId = uuid();\n      const path = 'api/image/save';\n      const requestBody = {\n        'imageId': _this.imageId,\n        'privatekey': '**GSew10o0uJiAg4qpTAvQ$KEMaCjC6P7@su2Dd1C9#a8Y$VISWXzYogPhYk&N6p5&cGb1k@nGFX',\n        'dataUrl': imagebase64\n      };\n\n      _this.http.post(_this.serverUrl + path, requestBody).toPromise().then(() => {}, error => {\n        console.log(error);\n      });\n    })();\n  }\n\n  close() {\n    this.modalController.dismiss({\n      result: 'cancel'\n    });\n  }\n\n  getimage() {\n    this.contentHeight = this.swCanvas.height / 4;\n    this.contentWidth = this.swCanvas.width / 4;\n    return this.sanitizer.bypassSecurityTrustResourceUrl('' + this.imagebase64);\n  }\n\n  sleep(milliseconds) {\n    const date = Date.now();\n    let currentDate = null;\n\n    do {\n      currentDate = Date.now();\n    } while (currentDate - date < milliseconds);\n  }\n\n  getRemoteImage() {\n    this.sleep(200);\n    return this.serverUrl + 'Content/SignWriting/' + this.imageId + '.png';\n  }\n\n  socialShare() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      const self = _this2;\n      const navShare = window.navigator;\n\n      if (navShare.share) {\n        _this2.canvas.toBlob(function (blob) {\n          var _this3 = this;\n\n          const filename = 'signWriting.png';\n          const fd = new FormData();\n          const files = [];\n          fd.append('SignWriting', blob, filename);\n\n          for (const newfile of fd.getAll('file')) {\n            files.push(newfile);\n          }\n\n          navShare.share({\n            files: files\n          }).then( /*#__PURE__*/_asyncToGenerator(function* () {\n            yield self.presentToast(_this3.translateService.instant('Thanks for sharing!'));\n            console.log('Thanks for sharing!');\n          })).catch(console.error);\n        });\n      } else {\n        yield self.presentToast(_this2.translateService.instant('Share is not available.'));\n      }\n    })();\n  }\n\n  copyToClipboard(event) {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      const self = _this4;\n\n      try {\n        const canvas = _this4.canvas;\n\n        _this4.canvas.toBlob( /*#__PURE__*/function () {\n          var _ref2 = _asyncToGenerator(function* (blob) {\n            if (navigator['clipboard']) {\n              // Safe to use Async Clipboard API!\n              const clip = navigator['clipboard'];\n\n              try {\n                clip.write([new ClipboardItem({\n                  'image/png': blob\n                })]).then( /*#__PURE__*/_asyncToGenerator(function* () {\n                  yield self.presentToast('Copied to clipboard successfully!');\n                  console.log('Copied to clipboard successfully!');\n                }), /*#__PURE__*/function () {\n                  var _ref4 = _asyncToGenerator(function* (err) {\n                    console.error(err);\n                    yield self.presentToast('Unable to write to clipboard. :-(');\n                    console.error('Unable to write to clipboard. :-(');\n                  });\n\n                  return function (_x2) {\n                    return _ref4.apply(this, arguments);\n                  };\n                }());\n              } catch (error) {\n                clip.setImageData(blob, 'image/png');\n              }\n            } else {\n              const img = document.createElement('img');\n              img.src = canvas.toDataURL();\n              document.body.appendChild(img);\n              const r = document.createRange();\n              r.setStartBefore(img);\n              r.setEndAfter(img);\n              r.selectNode(img);\n              const sel = window.getSelection();\n              sel.addRange(r);\n              const wascopied = document.execCommand('copy');\n\n              if (!wascopied) {\n                yield self.presentToast('You need to right click or long press on image to copy it.');\n                alert('You need to right click or long press on image to copy it.');\n              } else {\n                yield self.presentToast('Image was copied.');\n              }\n\n              img.remove();\n            }\n          });\n\n          return function (_x) {\n            return _ref2.apply(this, arguments);\n          };\n        }());\n      } catch (error) {\n        yield self.presentToast('Unable to write to clipboard. :-(');\n        console.error('Unable to write to clipboard. :-(');\n        console.error(error);\n      }\n    })();\n  }\n\n  presentToast(message) {\n    var _this5 = this;\n\n    return _asyncToGenerator(function* () {\n      const toast = yield _this5.toastController.create({\n        message: message,\n        duration: 2000\n      });\n      toast.present();\n    })();\n  }\n\n}\n\nShareDesktopPage.ɵfac = function ShareDesktopPage_Factory(t) {\n  return new (t || ShareDesktopPage)(i0.ɵɵdirectiveInject(i1.ModalController), i0.ɵɵdirectiveInject(i1.ToastController), i0.ɵɵdirectiveInject(i2.DomSanitizer), i0.ɵɵdirectiveInject(i3.TranslateService), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef), i0.ɵɵdirectiveInject(i4.HttpClient));\n};\n\nShareDesktopPage.ɵcmp = i0.ɵɵdefineComponent({\n  type: ShareDesktopPage,\n  selectors: [[\"app-share-desktop\"]],\n  inputs: {\n    canvas: \"canvas\"\n  },\n  decls: 15,\n  vars: 14,\n  consts: [[3, \"click\"], [\"slot\", \"end\"], [\"color\", \"primary\", 3, \"click\"], [\"name\", \"close-circle\"], [\"padding\", \"\"], [3, \"src\"]],\n  template: function ShareDesktopPage_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"ion-header\");\n      i0.ɵɵelementStart(1, \"ion-toolbar\");\n      i0.ɵɵelementStart(2, \"ion-title\");\n      i0.ɵɵtext(3);\n      i0.ɵɵpipe(4, \"translate\");\n      i0.ɵɵelementStart(5, \"ion-button\", 0);\n      i0.ɵɵlistener(\"click\", function ShareDesktopPage_Template_ion_button_click_5_listener() {\n        return ctx.copyToClipboard(ctx);\n      });\n      i0.ɵɵtext(6);\n      i0.ɵɵpipe(7, \"translate\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtext(8);\n      i0.ɵɵpipe(9, \"translate\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(10, \"ion-buttons\", 1);\n      i0.ɵɵelementStart(11, \"ion-button\", 2);\n      i0.ɵɵlistener(\"click\", function ShareDesktopPage_Template_ion_button_click_11_listener() {\n        return ctx.close();\n      });\n      i0.ɵɵelement(12, \"ion-icon\", 3);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(13, \"ion-content\", 4);\n      i0.ɵɵelement(14, \"img\", 5);\n      i0.ɵɵelementEnd();\n    }\n\n    if (rf & 2) {\n      i0.ɵɵadvance(3);\n      i0.ɵɵtextInterpolate1(\"\", i0.ɵɵpipeBind1(4, 8, \"Share Desktop\"), \" \");\n      i0.ɵɵadvance(3);\n      i0.ɵɵtextInterpolate1(\"\", i0.ɵɵpipeBind1(7, 10, \"Copy\"), \" \");\n      i0.ɵɵadvance(2);\n      i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(9, 12, \"Right-click on image to share\"));\n      i0.ɵɵadvance(6);\n      i0.ɵɵstyleProp(\"height\", ctx.contentHeight, \"px\")(\"width\", ctx.contentWidth, \"px\");\n      i0.ɵɵproperty(\"src\", ctx.getimage(), i0.ɵɵsanitizeUrl);\n    }\n  },\n  directives: [i1.IonHeader, i1.IonToolbar, i1.IonTitle, i1.IonButton, i1.IonButtons, i1.IonIcon, i1.IonContent],\n  pipes: [i3.TranslatePipe],\n  styles: [\"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzaGFyZS1kZXNrdG9wLnBhZ2Uuc2NzcyJ9 */\"]\n});","map":{"version":3,"sources":["C:\\Users\\Fernando Martinez\\Documents\\Programacion\\SignWriter\\Frontend JD\\src\\app\\share-desktop\\share-desktop.page.ts","C:\\Users\\Fernando Martinez\\Documents\\Programacion\\SignWriter\\Frontend JD\\src\\app\\share-desktop\\share-desktop.page.html"],"names":[],"mappings":"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","sourcesContent":["import { TranslateService } from '@ngx-translate/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Component, OnInit, Input, ElementRef, ViewChild, ChangeDetectorRef } from '@angular/core';\r\nimport { ModalController, ToastController } from '@ionic/angular';\r\nimport { DomSanitizer } from '@angular/platform-browser';\r\nimport { uuid } from 'uuidv4';\r\ndeclare class ClipboardItem {\r\n  constructor(data: { [mimeType: string]: Blob });\r\n}\r\n\r\n@Component({\r\n  selector: 'app-share-desktop',\r\n  templateUrl: './share-desktop.page.html',\r\n  styleUrls: ['./share-desktop.page.scss'],\r\n})\r\nexport class ShareDesktopPage implements OnInit {\r\n  public imagebase64: string;\r\n  public contentWidth: Number;\r\n  public contentHeight: Number;\r\n  public swCanvas: HTMLCanvasElement; // your canvas element\r\n  public modalCtrl: HTMLIonModalElement;\r\n  public imageId: string;\r\n  private serverUrl =\r\n    (window.location\r\n      && window.location.hostname\r\n      && window.location.hostname.includes('localhost'))\r\n      ? 'https://localhost:44309/'\r\n      : 'https://swsignwriterapi.azurewebsites.net/';\r\n\r\n  @Input() canvas: HTMLCanvasElement;\r\n  constructor(public modalController: ModalController,\r\n    public toastController: ToastController,\r\n    private sanitizer: DomSanitizer,\r\n    private translateService: TranslateService,\r\n    private ref: ChangeDetectorRef,\r\n    private http: HttpClient) { }\r\n\r\n  ngOnInit() {\r\n    this.swCanvas = this.canvas;\r\n    this.saveToRemote(this.imagebase64);\r\n  }\r\n\r\n  ngAfterContentChecked() {\r\n    this.ref.detectChanges();\r\n  }\r\n\r\n  async saveToRemote(imagebase64: string) {\r\n    this.imageId = uuid();\r\n\r\n    const path = 'api/image/save';\r\n    const requestBody = {\r\n      'imageId': this.imageId,\r\n      'privatekey': '**GSew10o0uJiAg4qpTAvQ$KEMaCjC6P7@su2Dd1C9#a8Y$VISWXzYogPhYk&N6p5&cGb1k@nGFX',\r\n      'dataUrl': imagebase64\r\n    };\r\n\r\n    this.http.post(this.serverUrl + path, requestBody)\r\n      .toPromise()\r\n      .then(() => { },\r\n        error => {\r\n          console.log(error);\r\n        });\r\n  }\r\n\r\n  close() {\r\n    this.modalController.dismiss({\r\n      result: 'cancel'\r\n    });\r\n  }\r\n\r\n  getimage() {\r\n    this.contentHeight = this.swCanvas.height / 4;\r\n    this.contentWidth = this.swCanvas.width / 4;\r\n    return this.sanitizer.bypassSecurityTrustResourceUrl('' + this.imagebase64);\r\n  }\r\n\r\n  sleep(milliseconds) {\r\n    const date = Date.now();\r\n    let currentDate = null;\r\n    do {\r\n      currentDate = Date.now();\r\n    } while (currentDate - date < milliseconds);\r\n  }\r\n\r\n  getRemoteImage() {\r\n    this.sleep(200);\r\n\r\n    return this.serverUrl + 'Content/SignWriting/' + this.imageId + '.png';\r\n  }\r\n\r\n  async socialShare() {\r\n    const self = this;\r\n    const navShare = (window.navigator as any);\r\n    if (navShare.share) {\r\n      this.canvas.toBlob(\r\n        function (blob) {\r\n          const filename = 'signWriting.png';\r\n          const fd = new FormData();\r\n          const files = [];\r\n          fd.append('SignWriting', blob, filename);\r\n          for (const newfile of fd.getAll('file')) {\r\n            files.push(newfile);\r\n          }\r\n          navShare.share({\r\n            files: files\r\n          }).then(async () => {\r\n            await self.presentToast(this.translateService.instant('Thanks for sharing!'));\r\n            console.log('Thanks for sharing!');\r\n          })\r\n            .catch(console.error);\r\n        });\r\n\r\n    } else {\r\n      await self.presentToast(this.translateService.instant('Share is not available.'));\r\n    }\r\n  }\r\n\r\n  async copyToClipboard(event) {\r\n    const self = this;\r\n\r\n    try {\r\n      const canvas = this.canvas;\r\n      this.canvas.toBlob(async function (blob) {\r\n        if (navigator['clipboard']) {\r\n          // Safe to use Async Clipboard API!\r\n          const clip = navigator['clipboard'] as any;\r\n          try {\r\n            clip.write([new ClipboardItem({ 'image/png': blob })]).then(async function () {\r\n              await self.presentToast('Copied to clipboard successfully!');\r\n              console.log('Copied to clipboard successfully!');\r\n            }, async function (err) {\r\n              console.error(err);\r\n              await self.presentToast('Unable to write to clipboard. :-(');\r\n              console.error('Unable to write to clipboard. :-(');\r\n            });\r\n          } catch (error) {\r\n            clip.setImageData(blob, 'image/png');\r\n          }\r\n        } else {\r\n          const img = document.createElement('img');\r\n          img.src = canvas.toDataURL();\r\n          document.body.appendChild(img);\r\n          const r = document.createRange();\r\n          r.setStartBefore(img);\r\n          r.setEndAfter(img);\r\n          r.selectNode(img);\r\n          const sel = window.getSelection();\r\n          sel.addRange(r);\r\n          const wascopied = document.execCommand('copy');\r\n          if (!wascopied) {\r\n            await self.presentToast('You need to right click or long press on image to copy it.');\r\n            alert('You need to right click or long press on image to copy it.');\r\n          } else {\r\n            await self.presentToast('Image was copied.');\r\n          }\r\n          img.remove();\r\n        }\r\n      });\r\n    } catch (error) {\r\n      await self.presentToast('Unable to write to clipboard. :-(');\r\n      console.error('Unable to write to clipboard. :-(');\r\n      console.error(error);\r\n    }\r\n  }\r\n  async presentToast(message) {\r\n    const toast = await this.toastController.create({\r\n      message: message,\r\n      duration: 2000\r\n    });\r\n    toast.present();\r\n\r\n  }\r\n}\r\n","<ion-header>\r\n  <ion-toolbar>\r\n    <ion-title>{{'Share Desktop'| translate}} <ion-button (click)=\"copyToClipboard(this)\">{{'Copy'| translate}} </ion-button>{{'Right-click on image to share'| translate}}</ion-title>\r\n    <ion-buttons slot=\"end\">\r\n      <ion-button color=\"primary\"   (click)=\"close()\">\r\n        <ion-icon name=\"close-circle\"></ion-icon>\r\n      </ion-button>\r\n    </ion-buttons>\r\n  </ion-toolbar>\r\n</ion-header>\r\n\r\n<ion-content padding>\r\n  <img [src]=\"getimage()\" [style.height.px]=\"contentHeight\" [style.width.px]=\"contentWidth\" />\r\n</ion-content>"],"sourceRoot":""},"metadata":{},"sourceType":"module"}